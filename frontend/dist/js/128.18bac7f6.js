"use strict";(self["webpackChunkenterprise_file_manager_frontend"]=self["webpackChunkenterprise_file_manager_frontend"]||[]).push([[128],{6128:function(e,l,t){t.r(l),t.d(l,{default:function(){return M}});var a=t(6768),n=t(144),u=t(5130),i=t(4232),o=t(1219),s=t(2933),r=t(7477),c=t(7504);const d={class:"recycle-container"},f={class:"toolbar"},k={class:"toolbar-left"},b={class:"toolbar-right"},v={class:"stats-row"},m={class:"stat-icon"},F={class:"stat-info"},_={class:"stat-number"},p={class:"stat-icon"},g={class:"stat-info"},h={class:"stat-number"},w={class:"stat-icon"},y={class:"stat-info"},L={class:"stat-number"},R={class:"stat-icon"},C={class:"stat-info"},W={class:"stat-number"},T={class:"recycle-list"},B={class:"item-info"},$={class:"item-details"},x={class:"item-name"},V={class:"item-meta"},A={class:"item-size"},K={class:"original-path"},z={key:0,class:"item-details-content"};var P={__name:"Recycle",setup(e){const l=(0,n.KR)(!1),t=(0,n.KR)(!1),P=(0,n.KR)(!1),I=(0,n.KR)([]),D=(0,n.KR)(""),M=(0,n.KR)([]),S=(0,n.KR)(!1),X=(0,n.KR)(null),Q=(0,n.KR)({totalItems:0,fileCount:0,folderCount:0,totalSize:0}),E=e=>{if(!e)return"0 B";const l=1024,t=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/Math.pow(l,a)).toFixed(2))+" "+t[a]},H=e=>E(e),U=e=>e?new Date(e).toLocaleString():"",j=e=>{M.value=e},G=async()=>{l.value=!0;try{const e=await(0,c.wb)();console.log("API Response:",e),console.log("Recycle Items:",e),I.value=e||[],Q.value={totalItems:I.value.length,fileCount:I.value.length,folderCount:0,totalSize:I.value.reduce((e,l)=>e+(l.size||0),0)}}catch(e){o.nk.error("加载回收站项目失败"),console.error("加载回收站项目失败:",e)}finally{l.value=!1}},J=()=>{G()},N=()=>{if(!D.value.trim())return void G();const e=D.value.toLowerCase();I.value=I.value.filter(l=>l.originalFilename.toLowerCase().includes(e)||l.filePath.toLowerCase().includes(e)),o.nk.success(`找到 ${I.value.length} 个匹配项目`)},q=async e=>{try{await s.s.confirm(`确定要恢复 "${e.originalFilename}" 吗？`,"恢复确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),await(0,c.VX)(e.id),o.nk.success("文件恢复成功"),await G()}catch(l){"cancel"!==l&&(o.nk.error("恢复文件失败"),console.error("恢复文件失败:",l))}},O=async()=>{if(0!==M.value.length)try{await s.s.confirm(`确定要恢复选中的 ${M.value.length} 个文件吗？`,"批量恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),P.value=!0;for(const e of M.value)await(0,c.VX)(e.id);o.nk.success(`成功恢复 ${M.value.length} 个文件`),M.value=[],await G()}catch(e){"cancel"!==e&&(o.nk.error("批量恢复失败"),console.error("批量恢复失败:",e))}finally{P.value=!1}else o.nk.warning("请选择要恢复的项目")},Y=async e=>{try{await s.s.confirm(`确定要彻底删除 "${e.originalFilename}" 吗？此操作不可恢复！`,"彻底删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",inputPattern:new RegExp(`^${e.originalFilename}$`),inputPlaceholder:`请输入 "${e.originalFilename}" 确认删除`,inputValidator:l=>l===e.originalFilename||"输入的文件名称不正确",showInput:!0}),await(0,c.QF)(e.id),o.nk.success("文件已彻底删除"),await G()}catch(l){"cancel"!==l&&(o.nk.error("彻底删除失败"),console.error("彻底删除失败:",l))}},Z=async()=>{try{await s.s.confirm("确定要清空回收站吗？此操作将彻底删除所有文件，不可恢复！","清空回收站",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",inputPattern:/^清空回收站$/,inputPlaceholder:'请输入 "清空回收站" 确认操作',inputValidator:e=>"清空回收站"===e||'请输入 "清空回收站" 确认操作',showInput:!0}),t.value=!0,await(0,c.cH)(),o.nk.success("回收站已清空"),await G()}catch(e){"cancel"!==e&&(o.nk.error("清空回收站失败"),console.error("清空回收站失败:",e))}finally{t.value=!1}},ee=e=>{X.value=e,S.value=!0};return(0,a.sV)(()=>{G()}),(e,o)=>{const s=(0,a.g2)("el-icon"),c=(0,a.g2)("el-button"),G=(0,a.g2)("el-input"),le=(0,a.g2)("el-card"),te=(0,a.g2)("el-col"),ae=(0,a.g2)("el-row"),ne=(0,a.g2)("el-table-column"),ue=(0,a.g2)("el-tag"),ie=(0,a.g2)("el-button-group"),oe=(0,a.g2)("el-table"),se=(0,a.g2)("el-descriptions-item"),re=(0,a.g2)("el-descriptions"),ce=(0,a.g2)("el-dialog"),de=(0,a.gN)("loading");return(0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("div",f,[(0,a.Lk)("div",k,[(0,a.bF)(c,{type:"danger",onClick:Z,loading:t.value},{default:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Delete))]),_:1}),o[3]||(o[3]=(0,a.eW)(" 清空回收站 ",-1))]),_:1},8,["loading"]),(0,a.bF)(c,{type:"success",onClick:O,disabled:!M.value.length,loading:P.value},{default:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.RefreshLeft))]),_:1}),o[4]||(o[4]=(0,a.eW)(" 恢复选中 ",-1))]),_:1},8,["disabled","loading"]),(0,a.bF)(c,{onClick:J,loading:l.value},{default:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Refresh))]),_:1}),o[5]||(o[5]=(0,a.eW)(" 刷新 ",-1))]),_:1},8,["loading"])]),(0,a.Lk)("div",b,[(0,a.bF)(G,{modelValue:D.value,"onUpdate:modelValue":o[0]||(o[0]=e=>D.value=e),placeholder:"搜索回收站项目...",style:{width:"200px"},clearable:"",onKeyup:(0,u.jR)(N,["enter"])},{prefix:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Search))]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(c,{onClick:N},{default:(0,a.k6)(()=>[...o[6]||(o[6]=[(0,a.eW)("搜索",-1)])]),_:1})])]),(0,a.Lk)("div",v,[(0,a.bF)(ae,{gutter:20},{default:(0,a.k6)(()=>[(0,a.bF)(te,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(le,{class:"stat-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",m,[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Delete))]),_:1})]),(0,a.Lk)("div",F,[(0,a.Lk)("div",_,(0,i.v_)(Q.value.totalItems||0),1),o[7]||(o[7]=(0,a.Lk)("div",{class:"stat-label"},"总项目数",-1))])]),_:1})]),_:1}),(0,a.bF)(te,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(le,{class:"stat-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",p,[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Document))]),_:1})]),(0,a.Lk)("div",g,[(0,a.Lk)("div",h,(0,i.v_)(Q.value.fileCount||0),1),o[8]||(o[8]=(0,a.Lk)("div",{class:"stat-label"},"文件数",-1))])]),_:1})]),_:1}),(0,a.bF)(te,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(le,{class:"stat-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",w,[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Folder))]),_:1})]),(0,a.Lk)("div",y,[(0,a.Lk)("div",L,(0,i.v_)(Q.value.folderCount||0),1),o[9]||(o[9]=(0,a.Lk)("div",{class:"stat-label"},"文件夹数",-1))])]),_:1})]),_:1}),(0,a.bF)(te,{span:6},{default:(0,a.k6)(()=>[(0,a.bF)(le,{class:"stat-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",R,[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.DataLine))]),_:1})]),(0,a.Lk)("div",C,[(0,a.Lk)("div",W,(0,i.v_)(H(Q.value.totalSize||0)),1),o[10]||(o[10]=(0,a.Lk)("div",{class:"stat-label"},"总大小",-1))])]),_:1})]),_:1})]),_:1})]),(0,a.Lk)("div",T,[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(oe,{data:I.value,style:{width:"100%"},onSelectionChange:j},{default:(0,a.k6)(()=>[(0,a.bF)(ne,{type:"selection",width:"55"}),(0,a.bF)(ne,{label:"项目信息","min-width":"300"},{default:(0,a.k6)(({row:e})=>[(0,a.Lk)("div",B,[(0,a.bF)(s,{class:"item-icon"},{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Document))]),_:1}),(0,a.Lk)("div",$,[(0,a.Lk)("div",x,(0,i.v_)(e.originalFilename),1),(0,a.Lk)("div",V,[(0,a.bF)(ue,{size:"small",type:"primary"},{default:(0,a.k6)(()=>[...o[11]||(o[11]=[(0,a.eW)(" 文件 ",-1)])]),_:1}),(0,a.Lk)("span",A,(0,i.v_)(E(e.size)),1),(0,a.Lk)("span",K,"路径: "+(0,i.v_)(e.filePath),1)])])])]),_:1}),(0,a.bF)(ne,{prop:"deleteTime",label:"删除时间",width:"180"},{default:(0,a.k6)(({row:e})=>[(0,a.eW)((0,i.v_)(U(e.deleteTime)),1)]),_:1}),(0,a.bF)(ne,{prop:"contentType",label:"文件类型",width:"120"}),(0,a.bF)(ne,{label:"操作",width:"200"},{default:(0,a.k6)(({row:e})=>[(0,a.bF)(ie,null,{default:(0,a.k6)(()=>[(0,a.bF)(c,{size:"small",type:"success",onClick:l=>q(e)},{default:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.RefreshLeft))]),_:1}),o[12]||(o[12]=(0,a.eW)(" 恢复 ",-1))]),_:1},8,["onClick"]),(0,a.bF)(c,{size:"small",onClick:l=>ee(e)},{default:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.View))]),_:1}),o[13]||(o[13]=(0,a.eW)(" 详情 ",-1))]),_:1},8,["onClick"]),(0,a.bF)(c,{size:"small",type:"danger",onClick:l=>Y(e)},{default:(0,a.k6)(()=>[(0,a.bF)(s,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.Delete))]),_:1}),o[14]||(o[14]=(0,a.eW)(" 彻底删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[de,l.value]])]),(0,a.bF)(ce,{modelValue:S.value,"onUpdate:modelValue":o[2]||(o[2]=e=>S.value=e),title:"项目详情",width:"600px"},{footer:(0,a.k6)(()=>[(0,a.bF)(c,{onClick:o[1]||(o[1]=e=>S.value=!1)},{default:(0,a.k6)(()=>[...o[16]||(o[16]=[(0,a.eW)("关闭",-1)])]),_:1})]),default:(0,a.k6)(()=>[X.value?((0,a.uX)(),(0,a.CE)("div",z,[(0,a.bF)(re,{column:2,border:""},{default:(0,a.k6)(()=>[(0,a.bF)(se,{label:"文件名称"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(X.value.originalFilename),1)]),_:1}),(0,a.bF)(se,{label:"文件类型"},{default:(0,a.k6)(()=>[(0,a.bF)(ue,{type:"primary"},{default:(0,a.k6)(()=>[...o[15]||(o[15]=[(0,a.eW)(" 文件 ",-1)])]),_:1})]),_:1}),(0,a.bF)(se,{label:"文件大小"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(E(X.value.size)),1)]),_:1}),(0,a.bF)(se,{label:"删除时间"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(U(X.value.deleteTime)),1)]),_:1}),(0,a.bF)(se,{label:"创建时间"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(U(X.value.createTime)),1)]),_:1}),(0,a.bF)(se,{label:"文件路径",span:2},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(X.value.filePath),1)]),_:1}),(0,a.bF)(se,{label:"文件类型"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(X.value.contentType),1)]),_:1}),(0,a.bF)(se,{label:"下载次数"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(X.value.downloadCount||0),1)]),_:1})]),_:1})])):(0,a.Q3)("",!0)]),_:1},8,["modelValue"])])}}},I=t(1241);const D=(0,I.A)(P,[["__scopeId","data-v-398ef3da"]]);var M=D},7504:function(e,l,t){t.d(l,{H5:function(){return s},Jk:function(){return n},QF:function(){return f},QM:function(){return u},VX:function(){return d},Ww:function(){return o},_K:function(){return r},cH:function(){return k},downloadFile:function(){return i},wb:function(){return c}});var a=t(5720);function n(e){return(0,a.A)({url:"/files/list",method:"get",params:e})}function u(e,l){return(0,a.A)({url:"/files/upload",method:"post",data:e,onUploadProgress:l,timeout:3e5})}function i(e){return(0,a.A)({url:`/files/download/${e}`,method:"get",responseType:"blob"})}function o(e){return(0,a.A)({url:`/files/${e}`,method:"delete"})}function s(e,l){return(0,a.A)({url:`/files/${e}/rename`,method:"put",data:{name:l}})}function r(e){return(0,a.A)({url:"/files/search",method:"get",params:{keyword:e}})}function c(){return(0,a.A)({url:"/files/recycle/bin",method:"get"})}function d(e){return(0,a.A)({url:`/files/${e}/restore`,method:"put"})}function f(e){return(0,a.A)({url:`/files/recycle/bin/${e}`,method:"delete"})}function k(){return(0,a.A)({url:"/files/recycle/bin/empty",method:"delete"})}}}]);
//# sourceMappingURL=128.18bac7f6.js.map