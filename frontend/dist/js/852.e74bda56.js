"use strict";(self["webpackChunkenterprise_file_manager_frontend"]=self["webpackChunkenterprise_file_manager_frontend"]||[]).push([[852],{646:function(e,l,t){t.d(l,{f6:function(){return n},iE:function(){return i},sE:function(){return r},vV:function(){return u},xv:function(){return o}});var a=t(5720);function n(e){return(0,a.A)({url:"/folders/list",method:"get",params:e})}function u(e){return(0,a.A)({url:"/folders/create",method:"post",data:e})}function r(e){return(0,a.A)({url:`/folders/${e}`,method:"delete"})}function o(e,l){return(0,a.A)({url:`/folders/${e}/rename`,method:"put",data:{name:l}})}function i(e){return(0,a.A)({url:`/folders/${e}/path`,method:"get"})}},7504:function(e,l,t){t.d(l,{H5:function(){return i},Jk:function(){return n},QF:function(){return f},QM:function(){return u},VX:function(){return s},Ww:function(){return o},_K:function(){return d},cH:function(){return p},downloadFile:function(){return r},wb:function(){return c}});var a=t(5720);function n(e){return(0,a.A)({url:"/files/list",method:"get",params:e})}function u(e,l){return(0,a.A)({url:"/files/upload",method:"post",data:e,onUploadProgress:l,timeout:3e5})}function r(e){return(0,a.A)({url:`/files/download/${e}`,method:"get",responseType:"blob"})}function o(e){return(0,a.A)({url:`/files/${e}`,method:"delete"})}function i(e,l){return(0,a.A)({url:`/files/${e}/rename`,method:"put",data:{name:l}})}function d(e){return(0,a.A)({url:"/files/search",method:"get",params:{keyword:e}})}function c(){return(0,a.A)({url:"/files/recycle/bin",method:"get"})}function s(e){return(0,a.A)({url:`/files/${e}/restore`,method:"put"})}function f(e){return(0,a.A)({url:`/files/recycle/bin/${e}`,method:"delete"})}function p(){return(0,a.A)({url:"/files/recycle/bin/empty",method:"delete"})}},8852:function(e,l,t){t.r(l),t.d(l,{default:function(){return L}});var a=t(6768),n=t(144),u=t(5130),r=t(4232),o=t(1219),i=t(2933),d=t(7477),c=t(7504),s=t(646);const f={class:"files-container"},p={class:"toolbar"},m={class:"toolbar-left"},k={class:"toolbar-right"},v={class:"file-list"},b={class:"file-info"},h={class:"file-name"},g={key:0,class:"upload-progress"},F={class:"progress-info"},w={class:"file-name"},_={class:"progress-percent"};var y={__name:"List",setup(e){const l=(0,n.KR)(!1),t=(0,n.KR)(!1),y=(0,n.KR)([]),R=(0,n.KR)(""),C=(0,n.KR)(!1),L=(0,n.KR)([]),A=(0,n.KR)([]),K=(0,n.KR)([]),W=(0,n.Kh)({folderId:null}),x=e=>{if(!e)return"0 B";const l=1024,t=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/Math.pow(l,a)).toFixed(2))+" "+t[a]},V=e=>e?new Date(e).toLocaleString():"",B=async()=>{try{const e=await(0,s.f6)();A.value=e||[]}catch(e){console.error("加载文件夹列表失败:",e)}},E=async()=>{l.value=!0;try{const e=await(0,c.Jk)();y.value=e||[]}catch(e){o.nk.error("加载文件列表失败")}finally{l.value=!1}},I=()=>{E()},U=async()=>{if(R.value.trim()){l.value=!0;try{const e=await(0,c._K)(R.value);y.value=e||[],o.nk.success(`找到 ${y.value.length} 个文件`)}catch(e){o.nk.error("搜索失败")}finally{l.value=!1}}else await E()},$=e=>{L.value.push(e)},M=e=>{const l=L.value.findIndex(l=>l.uid===e.uid);l>-1&&L.value.splice(l,1)},T=async()=>{if(0!==L.value.length){t.value=!0,K.value=L.value.map(e=>({name:e.name,percent:0,status:""}));try{for(let e=0;e<L.value.length;e++){const l=L.value[e],t=new FormData;t.append("file",l.raw),W.folderId&&t.append("folderId",W.folderId),K.value[e].status="uploading",await(0,c.QM)(t,l=>{const t=Math.round(100*l.loaded/l.total);K.value[e].percent=t}),K.value[e].status="success",K.value[e].percent=100}o.nk.success("文件上传成功"),C.value=!1,L.value=[],K.value=[],W.folderId=null,await E()}catch(e){o.nk.error("文件上传失败"),K.value.forEach(e=>{"success"!==e.status&&(e.status="exception")})}finally{t.value=!1}}else o.nk.warning("请选择要上传的文件")},X=async e=>{try{const l=await(0,c.downloadFile)(e.id),t=new Blob([l.data]),a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=e.originalFilename||e.name,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}catch(l){o.nk.error("文件下载失败")}},z=async e=>{try{const{value:l}=await i.s.prompt("请输入文件的新名称","重命名文件",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:e.originalFilename||e.name,inputPattern:/.+/,inputErrorMessage:"文件名不能为空"});await(0,c.H5)(e.id,l),o.nk.success("文件重命名成功"),await E()}catch(l){"cancel"!==l&&o.nk.error("文件重命名失败")}},D=async e=>{try{await i.s.confirm(`确定要删除文件 "${e.originalFilename||e.name}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(0,c.Ww)(e.id),o.nk.success("文件删除成功"),await E()}catch(l){"cancel"!==l&&o.nk.error("文件删除失败")}};return(0,a.sV)(()=>{E(),B()}),(e,o)=>{const i=(0,a.g2)("el-icon"),c=(0,a.g2)("el-button"),s=(0,a.g2)("el-input"),L=(0,a.g2)("el-table-column"),B=(0,a.g2)("el-button-group"),E=(0,a.g2)("el-table"),Q=(0,a.g2)("el-option"),j=(0,a.g2)("el-select"),H=(0,a.g2)("el-form-item"),J=(0,a.g2)("el-form"),O=(0,a.g2)("el-upload"),P=(0,a.g2)("el-progress"),S=(0,a.g2)("el-dialog"),G=(0,a.gN)("loading");return(0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("div",p,[(0,a.Lk)("div",m,[(0,a.bF)(c,{type:"primary",onClick:o[0]||(o[0]=e=>C.value=!0)},{default:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Upload))]),_:1}),o[5]||(o[5]=(0,a.eW)(" 上传文件 ",-1))]),_:1}),(0,a.bF)(c,{onClick:I,loading:l.value},{default:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Refresh))]),_:1}),o[6]||(o[6]=(0,a.eW)(" 刷新 ",-1))]),_:1},8,["loading"])]),(0,a.Lk)("div",k,[(0,a.bF)(s,{modelValue:R.value,"onUpdate:modelValue":o[1]||(o[1]=e=>R.value=e),placeholder:"搜索文件...",style:{width:"200px"},clearable:"",onKeyup:(0,u.jR)(U,["enter"])},{prefix:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Search))]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(c,{onClick:U},{default:(0,a.k6)(()=>[...o[7]||(o[7]=[(0,a.eW)("搜索",-1)])]),_:1})])]),(0,a.Lk)("div",v,[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(E,{data:y.value,style:{width:"100%"}},{default:(0,a.k6)(()=>[(0,a.bF)(L,{label:"文件名","min-width":"300"},{default:(0,a.k6)(({row:e})=>[(0,a.Lk)("div",b,[(0,a.bF)(i,{class:"file-icon"},{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Document))]),_:1}),(0,a.Lk)("span",h,(0,r.v_)(e.originalFilename||e.name),1)])]),_:1}),(0,a.bF)(L,{prop:"size",label:"大小",width:"120"},{default:(0,a.k6)(({row:e})=>[(0,a.eW)((0,r.v_)(x(e.size)),1)]),_:1}),(0,a.bF)(L,{prop:"contentType",label:"类型",width:"150"}),(0,a.bF)(L,{prop:"createTime",label:"创建时间",width:"180"},{default:(0,a.k6)(({row:e})=>[(0,a.eW)((0,r.v_)(V(e.createTime)),1)]),_:1}),(0,a.bF)(L,{label:"操作",width:"280"},{default:(0,a.k6)(({row:e})=>[(0,a.bF)(B,null,{default:(0,a.k6)(()=>[(0,a.bF)(c,{size:"small",onClick:l=>X(e)},{default:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Download))]),_:1}),o[8]||(o[8]=(0,a.eW)(" 下载 ",-1))]),_:1},8,["onClick"]),(0,a.bF)(c,{size:"small",onClick:l=>z(e)},{default:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Edit))]),_:1}),o[9]||(o[9]=(0,a.eW)(" 重命名 ",-1))]),_:1},8,["onClick"]),(0,a.bF)(c,{size:"small",type:"danger",onClick:l=>D(e)},{default:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Delete))]),_:1}),o[10]||(o[10]=(0,a.eW)(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,l.value]])]),(0,a.bF)(S,{modelValue:C.value,"onUpdate:modelValue":o[4]||(o[4]=e=>C.value=e),title:"上传文件",width:"600px"},{footer:(0,a.k6)(()=>[(0,a.bF)(c,{onClick:o[3]||(o[3]=e=>C.value=!1)},{default:(0,a.k6)(()=>[...o[12]||(o[12]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(c,{type:"primary",onClick:T,loading:t.value},{default:(0,a.k6)(()=>[...o[13]||(o[13]=[(0,a.eW)(" 开始上传 ",-1)])]),_:1},8,["loading"])]),default:(0,a.k6)(()=>[(0,a.bF)(J,{model:W,"label-width":"80px"},{default:(0,a.k6)(()=>[(0,a.bF)(H,{label:"选择文件夹"},{default:(0,a.k6)(()=>[(0,a.bF)(j,{modelValue:W.folderId,"onUpdate:modelValue":o[2]||(o[2]=e=>W.folderId=e),placeholder:"选择目标文件夹（可选）",clearable:""},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{label:"根目录",value:null}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(A.value,e=>((0,a.uX)(),(0,a.Wv)(Q,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),(0,a.bF)(O,{ref:"uploadRef",class:"upload-area",drag:"",multiple:"","auto-upload":!1,"on-change":$,"on-remove":M,limit:10},{default:(0,a.k6)(()=>[(0,a.bF)(i,{class:"el-icon--upload"},{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(d.Upload))]),_:1}),o[11]||(o[11]=(0,a.Lk)("div",{class:"el-upload__text"},[(0,a.eW)(" 拖拽文件到此处或 "),(0,a.Lk)("em",null,"点击上传")],-1))]),_:1},512),K.value.length>0?((0,a.uX)(),(0,a.CE)("div",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(K.value,(e,l)=>((0,a.uX)(),(0,a.CE)("div",{key:l,class:"progress-item"},[(0,a.Lk)("div",F,[(0,a.Lk)("span",w,(0,r.v_)(e.name),1),(0,a.Lk)("span",_,(0,r.v_)(e.percent)+"%",1)]),(0,a.bF)(P,{percentage:e.percent,status:e.status},null,8,["percentage","status"])]))),128))])):(0,a.Q3)("",!0)]),_:1},8,["modelValue"])])}}},R=t(1241);const C=(0,R.A)(y,[["__scopeId","data-v-34e49f1e"]]);var L=C}}]);
//# sourceMappingURL=852.e74bda56.js.map