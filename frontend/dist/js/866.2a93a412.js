"use strict";(self["webpackChunkenterprise_file_manager_frontend"]=self["webpackChunkenterprise_file_manager_frontend"]||[]).push([[866],{6866:function(e,a,t){t.r(a),t.d(a,{default:function(){return w}});var n=t(6768),l=t(4232);const r={class:"files-container"},o={class:"card-header"},i={class:"pagination"};function u(e,a,t,u,d,s){const c=(0,n.g2)("el-button"),p=(0,n.g2)("el-table-column"),f=(0,n.g2)("el-table"),g=(0,n.g2)("el-pagination"),h=(0,n.g2)("el-card"),m=(0,n.g2)("upload-filled"),b=(0,n.g2)("el-icon"),w=(0,n.g2)("el-upload"),k=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.bF)(h,{class:"box-card"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",o,[a[5]||(a[5]=(0,n.Lk)("span",null,"文件管理",-1)),(0,n.bF)(c,{type:"primary",onClick:a[0]||(a[0]=e=>u.showUploadDialog=!0)},{default:(0,n.k6)(()=>[...a[4]||(a[4]=[(0,n.eW)(" 上传文件 ",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.bF)(f,{data:u.files,style:{width:"100%"}},{default:(0,n.k6)(()=>[(0,n.bF)(p,{prop:"fileName",label:"文件名",width:"200"}),(0,n.bF)(p,{prop:"fileSize",label:"文件大小",width:"120"},{default:(0,n.k6)(e=>[(0,n.eW)((0,l.v_)(u.formatFileSize(e.row.fileSize)),1)]),_:1}),(0,n.bF)(p,{prop:"contentType",label:"文件类型",width:"120"}),(0,n.bF)(p,{prop:"downloadCount",label:"下载次数",width:"100"}),(0,n.bF)(p,{prop:"createTime",label:"创建时间",width:"180"},{default:(0,n.k6)(e=>[(0,n.eW)((0,l.v_)(u.formatDate(e.row.createTime)),1)]),_:1}),(0,n.bF)(p,{label:"操作",width:"200"},{default:(0,n.k6)(e=>[(0,n.bF)(c,{size:"small",onClick:a=>u.downloadFile(e.row)},{default:(0,n.k6)(()=>[...a[6]||(a[6]=[(0,n.eW)(" 下载 ",-1)])]),_:1},8,["onClick"]),(0,n.bF)(c,{size:"small",type:"danger",onClick:a=>u.deleteFile(e.row)},{default:(0,n.k6)(()=>[...a[7]||(a[7]=[(0,n.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),(0,n.Lk)("div",i,[(0,n.bF)(g,{"current-page":u.currentPage,"onUpdate:currentPage":a[1]||(a[1]=e=>u.currentPage=e),"page-size":u.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>u.pageSize=e),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u.handleSizeChange,onCurrentChange:u.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),(0,n.bF)(k,{modelValue:u.showUploadDialog,"onUpdate:modelValue":a[3]||(a[3]=e=>u.showUploadDialog=e),title:"上传文件",width:"500px"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{class:"upload-demo",drag:"",action:"/api/files/upload",headers:u.uploadHeaders,"on-success":u.handleUploadSuccess,"on-error":u.handleUploadError,"before-upload":u.beforeUpload},{default:(0,n.k6)(()=>[(0,n.bF)(b,{class:"el-icon--upload"},{default:(0,n.k6)(()=>[(0,n.bF)(m)]),_:1}),a[8]||(a[8]=(0,n.Lk)("div",{class:"el-upload__text"},[(0,n.eW)(" 拖拽文件到此处或 "),(0,n.Lk)("em",null,"点击上传")],-1))]),_:1},8,["headers","on-success","on-error","before-upload"])]),_:1},8,["modelValue"])])}var d=t(144),s=t(1219),c=t(2933),p=t(7477),f=t(7504),g=t(3603),h={name:"Files",components:{UploadFilled:p.UploadFilled},setup(){const e=(0,d.KR)([]),a=(0,d.KR)(1),t=(0,d.KR)(20),l=(0,d.KR)(0),r=(0,d.KR)(!1),o={Authorization:`Bearer ${(0,g.gf)()}`},i=async()=>{try{const n=await(0,f.getFiles)({page:a.value-1,size:t.value});e.value=n.data.content,l.value=n.data.totalElements}catch(n){s.nk.error("加载文件列表失败")}},u=e=>{t.value=e,i()},p=e=>{a.value=e,i()},h=e=>{window.open(`/api/files/download/${e.id}`,"_blank")},m=async e=>{try{await c.s.confirm("确定要删除这个文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(0,f.Ww)(e.id),s.nk.success("删除成功"),i()}catch(a){"cancel"!==a&&s.nk.error("删除失败")}},b=e=>{const a=e.size/1024/1024<100;return a||s.nk.error("文件大小不能超过 100MB!"),a},w=()=>{s.nk.success("上传成功"),r.value=!1,i()},k=()=>{s.nk.error("上传失败")},F=e=>{if(0===e)return"0 B";const a=1024,t=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,n)).toFixed(2))+" "+t[n]},_=e=>new Date(e).toLocaleString();return(0,n.sV)(()=>{i()}),{files:e,currentPage:a,pageSize:t,total:l,showUploadDialog:r,uploadHeaders:o,handleSizeChange:u,handleCurrentChange:p,downloadFile:h,deleteFile:m,beforeUpload:b,handleUploadSuccess:w,handleUploadError:k,formatFileSize:F,formatDate:_}}},m=t(1241);const b=(0,m.A)(h,[["render",u],["__scopeId","data-v-074017a4"]]);var w=b},7504:function(e,a,t){t.d(a,{H5:function(){return u},Jk:function(){return l},QF:function(){return p},QM:function(){return r},VX:function(){return c},Ww:function(){return i},_K:function(){return d},cH:function(){return f},downloadFile:function(){return o},wb:function(){return s}});var n=t(5720);function l(e){return(0,n.A)({url:"/files/list",method:"get",params:e})}function r(e,a){return(0,n.A)({url:"/files/upload",method:"post",data:e,onUploadProgress:a,timeout:3e5})}function o(e){return(0,n.A)({url:`/files/download/${e}`,method:"get",responseType:"blob"})}function i(e){return(0,n.A)({url:`/files/${e}`,method:"delete"})}function u(e,a){return(0,n.A)({url:`/files/${e}/rename`,method:"put",data:{name:a}})}function d(e){return(0,n.A)({url:"/files/search",method:"get",params:{keyword:e}})}function s(){return(0,n.A)({url:"/files/recycle/bin",method:"get"})}function c(e){return(0,n.A)({url:`/files/${e}/restore`,method:"put"})}function p(e){return(0,n.A)({url:`/files/recycle/bin/${e}`,method:"delete"})}function f(){return(0,n.A)({url:"/files/recycle/bin/empty",method:"delete"})}}}]);
//# sourceMappingURL=866.2a93a412.js.map