"use strict";(self["webpackChunkenterprise_file_manager_frontend"]=self["webpackChunkenterprise_file_manager_frontend"]||[]).push([[752],{3752:function(e,l,a){a.r(l),a.d(l,{default:function(){return A}});var t=a(6768),n=a(4232),s=a(5130);const o={class:"system-container"},i={class:"card-header"},r={class:"stats-row"},u={class:"stat-icon"},c={class:"stat-info"},d={class:"stat-number"},m={class:"stat-icon"},f={class:"stat-info"},b={class:"stat-number"},k={class:"stat-icon"},g={class:"stat-info"},F={class:"stat-number"},v={class:"stat-icon"},p={class:"stat-info"},y={class:"stat-number"},h={class:"filter-row"},_={class:"recycle-list"},w={class:"item-info"},C={class:"item-details"},L={class:"item-name"},R={class:"item-meta"},V={class:"item-size"},T={class:"item-user"},B={key:0,class:"batch-actions"};function I(e,l,a,I,S,x){const D=(0,t.g2)("el-input"),W=(0,t.g2)("el-form-item"),K=(0,t.g2)("el-input-number"),U=(0,t.g2)("el-option"),$=(0,t.g2)("el-select"),z=(0,t.g2)("el-switch"),A=(0,t.g2)("el-button"),P=(0,t.g2)("el-form"),N=(0,t.g2)("el-card"),M=(0,t.g2)("el-tab-pane"),E=(0,t.g2)("Delete"),O=(0,t.g2)("el-icon"),X=(0,t.g2)("el-col"),Q=(0,t.g2)("User"),j=(0,t.g2)("Calendar"),G=(0,t.g2)("DataLine"),H=(0,t.g2)("el-row"),J=(0,t.g2)("Search"),q=(0,t.g2)("Refresh"),Y=(0,t.g2)("el-table-column"),Z=(0,t.g2)("Document"),ee=(0,t.g2)("el-tag"),le=(0,t.g2)("RefreshLeft"),ae=(0,t.g2)("el-button-group"),te=(0,t.g2)("el-table"),ne=(0,t.g2)("el-descriptions-item"),se=(0,t.g2)("el-descriptions"),oe=(0,t.g2)("el-tabs"),ie=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.bF)(oe,{modelValue:I.activeTab,"onUpdate:modelValue":l[8]||(l[8]=e=>I.activeTab=e),type:"card"},{default:(0,t.k6)(()=>[(0,t.bF)(M,{label:"基础设置",name:"basic"},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"box-card"},{header:(0,t.k6)(()=>[...l[9]||(l[9]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"系统基础设置")],-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(P,{model:I.systemConfig,"label-width":"120px"},{default:(0,t.k6)(()=>[(0,t.bF)(W,{label:"系统名称"},{default:(0,t.k6)(()=>[(0,t.bF)(D,{modelValue:I.systemConfig.systemName,"onUpdate:modelValue":l[0]||(l[0]=e=>I.systemConfig.systemName=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(W,{label:"文件存储路径"},{default:(0,t.k6)(()=>[(0,t.bF)(D,{modelValue:I.systemConfig.storagePath,"onUpdate:modelValue":l[1]||(l[1]=e=>I.systemConfig.storagePath=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(W,{label:"最大文件大小"},{default:(0,t.k6)(()=>[(0,t.bF)(K,{modelValue:I.systemConfig.maxFileSize,"onUpdate:modelValue":l[2]||(l[2]=e=>I.systemConfig.maxFileSize=e),min:1,max:1e3},null,8,["modelValue"]),l[10]||(l[10]=(0,t.Lk)("span",{class:"unit"},"MB",-1))]),_:1}),(0,t.bF)(W,{label:"允许的文件类型"},{default:(0,t.k6)(()=>[(0,t.bF)($,{modelValue:I.systemConfig.allowedTypes,"onUpdate:modelValue":l[3]||(l[3]=e=>I.systemConfig.allowedTypes=e),multiple:"",placeholder:"选择允许的文件类型"},{default:(0,t.k6)(()=>[(0,t.bF)(U,{label:"图片",value:"image"}),(0,t.bF)(U,{label:"文档",value:"document"}),(0,t.bF)(U,{label:"视频",value:"video"}),(0,t.bF)(U,{label:"音频",value:"audio"}),(0,t.bF)(U,{label:"压缩包",value:"archive"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(W,{label:"会话超时"},{default:(0,t.k6)(()=>[(0,t.bF)(K,{modelValue:I.systemConfig.sessionTimeout,"onUpdate:modelValue":l[4]||(l[4]=e=>I.systemConfig.sessionTimeout=e),min:1,max:1440},null,8,["modelValue"]),l[11]||(l[11]=(0,t.Lk)("span",{class:"unit"},"分钟",-1))]),_:1}),(0,t.bF)(W,{label:"启用日志"},{default:(0,t.k6)(()=>[(0,t.bF)(z,{modelValue:I.systemConfig.enableLogging,"onUpdate:modelValue":l[5]||(l[5]=e=>I.systemConfig.enableLogging=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(W,{label:"日志级别"},{default:(0,t.k6)(()=>[(0,t.bF)($,{modelValue:I.systemConfig.logLevel,"onUpdate:modelValue":l[6]||(l[6]=e=>I.systemConfig.logLevel=e),placeholder:"选择日志级别"},{default:(0,t.k6)(()=>[(0,t.bF)(U,{label:"DEBUG",value:"DEBUG"}),(0,t.bF)(U,{label:"INFO",value:"INFO"}),(0,t.bF)(U,{label:"WARN",value:"WARN"}),(0,t.bF)(U,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(W,null,{default:(0,t.k6)(()=>[(0,t.bF)(A,{type:"primary",onClick:I.saveConfig},{default:(0,t.k6)(()=>[...l[12]||(l[12]=[(0,t.eW)("保存设置",-1)])]),_:1},8,["onClick"]),(0,t.bF)(A,{onClick:I.resetConfig},{default:(0,t.k6)(()=>[...l[13]||(l[13]=[(0,t.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),(0,t.bF)(M,{label:"回收站管理",name:"recycle"},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"box-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",i,[l[15]||(l[15]=(0,t.Lk)("span",null,"回收站管理",-1)),(0,t.bF)(A,{type:"danger",onClick:I.emptyAllRecycleBin,loading:I.emptying},{default:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(E)]),_:1}),l[14]||(l[14]=(0,t.eW)(" 清空所有用户回收站 ",-1))]),_:1},8,["onClick","loading"])])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",r,[(0,t.bF)(H,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)(X,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"stat-card"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",u,[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(E)]),_:1})]),(0,t.Lk)("div",c,[(0,t.Lk)("div",d,(0,n.v_)(I.recycleStats.totalItems||0),1),l[16]||(l[16]=(0,t.Lk)("div",{class:"stat-label"},"总文件数",-1))])]),_:1})]),_:1}),(0,t.bF)(X,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"stat-card"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",m,[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(Q)]),_:1})]),(0,t.Lk)("div",f,[(0,t.Lk)("div",b,(0,n.v_)(I.recycleStats.userCount||0),1),l[17]||(l[17]=(0,t.Lk)("div",{class:"stat-label"},"涉及用户",-1))])]),_:1})]),_:1}),(0,t.bF)(X,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"stat-card"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",k,[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(j)]),_:1})]),(0,t.Lk)("div",g,[(0,t.Lk)("div",F,(0,n.v_)(I.recycleStats.oldestDeleteTime||"无"),1),l[18]||(l[18]=(0,t.Lk)("div",{class:"stat-label"},"最早删除",-1))])]),_:1})]),_:1}),(0,t.bF)(X,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"stat-card"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",v,[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(G)]),_:1})]),(0,t.Lk)("div",p,[(0,t.Lk)("div",y,(0,n.v_)(I.formatStorage(I.recycleStats.totalSize||0)),1),l[19]||(l[19]=(0,t.Lk)("div",{class:"stat-label"},"总大小",-1))])]),_:1})]),_:1})]),_:1})]),(0,t.Lk)("div",h,[(0,t.bF)(H,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)(X,{span:8},{default:(0,t.k6)(()=>[(0,t.bF)(D,{modelValue:I.searchKeyword,"onUpdate:modelValue":l[7]||(l[7]=e=>I.searchKeyword=e),placeholder:"搜索文件名或用户名...",clearable:"",onKeyup:(0,s.jR)(I.searchRecycleBin,["enter"])},{prefix:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(J)]),_:1})]),_:1},8,["modelValue","onKeyup"])]),_:1}),(0,t.bF)(X,{span:4},{default:(0,t.k6)(()=>[(0,t.bF)(A,{onClick:I.searchRecycleBin},{default:(0,t.k6)(()=>[...l[20]||(l[20]=[(0,t.eW)("搜索",-1)])]),_:1},8,["onClick"])]),_:1}),(0,t.bF)(X,{span:4},{default:(0,t.k6)(()=>[(0,t.bF)(A,{onClick:I.refreshRecycleBin,loading:I.loading},{default:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(q)]),_:1}),l[21]||(l[21]=(0,t.eW)(" 刷新 ",-1))]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),(0,t.Lk)("div",_,[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(te,{data:I.recycleItems,style:{width:"100%"},onSelectionChange:I.handleSelectionChange},{default:(0,t.k6)(()=>[(0,t.bF)(Y,{type:"selection",width:"55"}),(0,t.bF)(Y,{label:"文件信息","min-width":"300"},{default:(0,t.k6)(({row:e})=>[(0,t.Lk)("div",w,[(0,t.bF)(O,{class:"item-icon"},{default:(0,t.k6)(()=>[(0,t.bF)(Z)]),_:1}),(0,t.Lk)("div",C,[(0,t.Lk)("div",L,(0,n.v_)(e.originalFilename),1),(0,t.Lk)("div",R,[(0,t.bF)(ee,{size:"small",type:"primary"},{default:(0,t.k6)(()=>[...l[22]||(l[22]=[(0,t.eW)(" 文件 ",-1)])]),_:1}),(0,t.Lk)("span",V,(0,n.v_)(I.formatFileSize(e.size)),1),(0,t.Lk)("span",T,"用户: "+(0,n.v_)(e.username||"未知"),1)])])])]),_:1}),(0,t.bF)(Y,{prop:"deleteTime",label:"删除时间",width:"180"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,n.v_)(I.formatDateTime(e.deleteTime)),1)]),_:1}),(0,t.bF)(Y,{prop:"username",label:"所属用户",width:"120"}),(0,t.bF)(Y,{label:"操作",width:"200"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(ae,null,{default:(0,t.k6)(()=>[(0,t.bF)(A,{size:"small",type:"success",onClick:l=>I.restoreItem(e)},{default:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(le)]),_:1}),l[23]||(l[23]=(0,t.eW)(" 恢复 ",-1))]),_:1},8,["onClick"]),(0,t.bF)(A,{size:"small",type:"danger",onClick:l=>I.deletePermanently(e)},{default:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(E)]),_:1}),l[24]||(l[24]=(0,t.eW)(" 彻底删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","onSelectionChange"])),[[ie,I.loading]])]),I.selectedItems.length>0?((0,t.uX)(),(0,t.CE)("div",B,[(0,t.bF)(A,{type:"success",onClick:I.batchRestore,loading:I.batchRestoring},{default:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(le)]),_:1}),(0,t.eW)(" 恢复选中 ("+(0,n.v_)(I.selectedItems.length)+") ",1)]),_:1},8,["onClick","loading"]),(0,t.bF)(A,{type:"danger",onClick:I.batchDelete,loading:I.batchDeleting},{default:(0,t.k6)(()=>[(0,t.bF)(O,null,{default:(0,t.k6)(()=>[(0,t.bF)(E)]),_:1}),(0,t.eW)(" 彻底删除选中 ("+(0,n.v_)(I.selectedItems.length)+") ",1)]),_:1},8,["onClick","loading"])])):(0,t.Q3)("",!0)]),_:1})]),_:1}),(0,t.bF)(M,{label:"系统信息",name:"info"},{default:(0,t.k6)(()=>[(0,t.bF)(N,{class:"box-card"},{header:(0,t.k6)(()=>[...l[25]||(l[25]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"系统信息")],-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(se,{column:2,border:""},{default:(0,t.k6)(()=>[(0,t.bF)(ne,{label:"系统版本"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(I.systemInfo.version),1)]),_:1}),(0,t.bF)(ne,{label:"构建时间"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(I.systemInfo.buildTime),1)]),_:1}),(0,t.bF)(ne,{label:"Java版本"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(I.systemInfo.javaVersion),1)]),_:1}),(0,t.bF)(ne,{label:"数据库版本"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(I.systemInfo.databaseVersion),1)]),_:1}),(0,t.bF)(ne,{label:"运行时间"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(I.systemInfo.uptime),1)]),_:1}),(0,t.bF)(ne,{label:"内存使用"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(I.systemInfo.memoryUsage),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var S=a(144),x=a(1219),D=a(2933),W=a(7477),K=a(7504),U={name:"System",components:{Delete:W.Delete,Refresh:W.Refresh,Search:W.Search,Document:W.Document,User:W.User,Calendar:W.Calendar,DataLine:W.DataLine,RefreshLeft:W.RefreshLeft},setup(){const e=(0,S.KR)("basic"),l=(0,S.KR)(!1),a=(0,S.KR)(!1),n=(0,S.KR)(!1),s=(0,S.KR)(!1),o=(0,S.KR)([]),i=(0,S.KR)(""),r=(0,S.KR)([]),u=(0,S.KR)({systemName:"企业文件管理系统",storagePath:"/app/storage",maxFileSize:100,allowedTypes:["image","document","video","audio","archive"],sessionTimeout:30,enableLogging:!0,logLevel:"INFO"}),c=(0,S.KR)({version:"2.0.0",buildTime:"2024-01-01 12:00:00",javaVersion:"17.0.2",databaseVersion:"8.0.35",uptime:"2天 3小时 45分钟",memoryUsage:"256MB / 1024MB"}),d=(0,S.KR)({totalItems:0,userCount:0,oldestDeleteTime:"无",totalSize:0}),m=e=>{if(!e)return"0 B";const l=1024,a=["B","KB","MB","GB","TB"],t=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/Math.pow(l,t)).toFixed(2))+" "+a[t]},f=e=>m(e),b=e=>e?new Date(e).toLocaleString():"",k=e=>{r.value=e},g=async()=>{l.value=!0;try{const e=await(0,K.wb)();o.value=e.data||[],d.value={totalItems:o.value.length,userCount:1,oldestDeleteTime:o.value.length>0?b(o.value[o.value.length-1].deleteTime):"无",totalSize:o.value.reduce((e,l)=>e+(l.size||0),0)}}catch(e){x.nk.error("加载回收站数据失败"),console.error("加载回收站数据失败:",e)}finally{l.value=!1}},F=()=>{g()},v=()=>{if(!i.value.trim())return void g();const e=i.value.toLowerCase();o.value=o.value.filter(l=>l.originalFilename.toLowerCase().includes(e)),x.nk.success(`找到 ${o.value.length} 个匹配项目`)},p=async e=>{try{await D.s.confirm(`确定要恢复 "${e.originalFilename}" 吗？`,"恢复确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),await(0,K.VX)(e.id),x.nk.success("文件恢复成功"),await g()}catch(l){"cancel"!==l&&(x.nk.error("恢复文件失败"),console.error("恢复文件失败:",l))}},y=async e=>{try{await D.s.confirm(`确定要彻底删除 "${e.originalFilename}" 吗？此操作不可恢复！`,"彻底删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",inputPattern:new RegExp(`^${e.originalFilename}$`),inputPlaceholder:`请输入 "${e.originalFilename}" 确认删除`,inputValidator:l=>l===e.originalFilename||"输入的文件名称不正确",showInput:!0}),await(0,K.QF)(e.id),x.nk.success("文件已彻底删除"),await g()}catch(l){"cancel"!==l&&(x.nk.error("彻底删除失败"),console.error("彻底删除失败:",l))}},h=async()=>{if(0!==r.value.length)try{await D.s.confirm(`确定要恢复选中的 ${r.value.length} 个文件吗？`,"批量恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),n.value=!0;for(const e of r.value)await(0,K.VX)(e.id);x.nk.success(`成功恢复 ${r.value.length} 个文件`),r.value=[],await g()}catch(e){"cancel"!==e&&(x.nk.error("批量恢复失败"),console.error("批量恢复失败:",e))}finally{n.value=!1}else x.nk.warning("请选择要恢复的文件")},_=async()=>{if(0!==r.value.length)try{await D.s.confirm(`确定要彻底删除选中的 ${r.value.length} 个文件吗？此操作不可恢复！`,"批量彻底删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",inputPattern:/^批量删除$/,inputPlaceholder:'请输入 "批量删除" 确认操作',inputValidator:e=>"批量删除"===e||'请输入 "批量删除" 确认操作',showInput:!0}),s.value=!0;for(const e of r.value)await(0,K.QF)(e.id);x.nk.success(`成功彻底删除 ${r.value.length} 个文件`),r.value=[],await g()}catch(e){"cancel"!==e&&(x.nk.error("批量彻底删除失败"),console.error("批量彻底删除失败:",e))}finally{s.value=!1}else x.nk.warning("请选择要彻底删除的文件")},w=async()=>{try{await D.s.confirm("确定要清空所有用户的回收站吗？此操作将彻底删除所有文件，不可恢复！","清空所有回收站",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",inputPattern:/^清空所有回收站$/,inputPlaceholder:'请输入 "清空所有回收站" 确认操作',inputValidator:e=>"清空所有回收站"===e||'请输入 "清空所有回收站" 确认操作',showInput:!0}),a.value=!0,await(0,K.cH)(),x.nk.success("所有回收站已清空"),await g()}catch(e){"cancel"!==e&&(x.nk.error("清空回收站失败"),console.error("清空回收站失败:",e))}finally{a.value=!1}},C=()=>{x.nk.success("设置保存成功")},L=()=>{u.value={systemName:"企业文件管理系统",storagePath:"/app/storage",maxFileSize:100,allowedTypes:["image","document","video","audio","archive"],sessionTimeout:30,enableLogging:!0,logLevel:"INFO"},x.nk.info("设置已重置")};return(0,t.sV)(()=>{g()}),{activeTab:e,loading:l,emptying:a,batchRestoring:n,batchDeleting:s,recycleItems:o,searchKeyword:i,selectedItems:r,systemConfig:u,systemInfo:c,recycleStats:d,formatFileSize:m,formatStorage:f,formatDateTime:b,handleSelectionChange:k,refreshRecycleBin:F,searchRecycleBin:v,restoreItem:p,deletePermanently:y,batchRestore:h,batchDelete:_,emptyAllRecycleBin:w,saveConfig:C,resetConfig:L}}},$=a(1241);const z=(0,$.A)(U,[["render",I],["__scopeId","data-v-4ad3e982"]]);var A=z},7504:function(e,l,a){a.d(l,{H5:function(){return r},Jk:function(){return n},QF:function(){return m},QM:function(){return s},VX:function(){return d},Ww:function(){return i},_K:function(){return u},cH:function(){return f},downloadFile:function(){return o},wb:function(){return c}});var t=a(5720);function n(e){return(0,t.A)({url:"/files/list",method:"get",params:e})}function s(e,l){return(0,t.A)({url:"/files/upload",method:"post",data:e,onUploadProgress:l,timeout:3e5})}function o(e){return(0,t.A)({url:`/files/download/${e}`,method:"get",responseType:"blob"})}function i(e){return(0,t.A)({url:`/files/${e}`,method:"delete"})}function r(e,l){return(0,t.A)({url:`/files/${e}/rename`,method:"put",data:{name:l}})}function u(e){return(0,t.A)({url:"/files/search",method:"get",params:{keyword:e}})}function c(){return(0,t.A)({url:"/files/recycle/bin",method:"get"})}function d(e){return(0,t.A)({url:`/files/${e}/restore`,method:"put"})}function m(e){return(0,t.A)({url:`/files/recycle/bin/${e}`,method:"delete"})}function f(){return(0,t.A)({url:"/files/recycle/bin/empty",method:"delete"})}}}]);
//# sourceMappingURL=752.21ae9f34.js.map