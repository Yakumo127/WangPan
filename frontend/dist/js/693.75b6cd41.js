"use strict";(self["webpackChunkenterprise_file_manager_frontend"]=self["webpackChunkenterprise_file_manager_frontend"]||[]).push([[693],{4693:function(e,a,r){r.r(a),r.d(a,{default:function(){return A}});var l=r(6768),s=r(144),t=r(4232),o=r(1219),n=r(7477),u=r(7756),d=r(7504),i=r(5720);const c={class:"profile-container"},m={class:"user-avatar"},f={class:"user-name"},p={class:"user-role"},v={class:"user-stats"},w={class:"stat-item"},b={class:"stat-value"},g={class:"stat-item"},k={class:"stat-value"},h={class:"stat-item"},_={class:"stat-value"},y={class:"stat-item"},F={class:"stat-value"},P={class:"card-header"};var L={__name:"Profile",setup(e){const a=(0,u.n)(),r=(0,s.KR)(!1),L=((0,s.KR)(!1),(0,s.KR)({usedStorage:0})),U=(0,s.KR)(),V=(0,s.Kh)({username:"",email:"",displayName:"",avatarUrl:"",currentPassword:"",newPassword:"",confirmPassword:""}),A=(0,l.EW)(()=>a.user),N={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],displayName:[{required:!0,message:"请输入显示名称",trigger:"blur"},{min:2,max:50,message:"显示名称长度在2-50个字符",trigger:"blur"}],currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{min:6,max:20,message:"密码长度在6-20个字符",trigger:"blur"}],confirmPassword:[{validator:(e,a,r)=>{a&&a!==V.newPassword?r(new Error("两次输入密码不一致")):r()},trigger:"blur"}]},R=e=>{if(!e)return"0 B";const a=1024,r=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+r[l]},K=e=>e?new Date(e).toLocaleString():"未设置",B=async()=>{try{const e=await(0,d.Jk)(),a=e||[];L.value={usedStorage:a.reduce((e,a)=>e+(a.size||0),0)}}catch(e){console.error("加载用户统计信息失败:",e)}},M=()=>{A.value&&(V.username=A.value.username,V.email=A.value.email,V.displayName=A.value.displayName,V.avatarUrl=A.value.avatarUrl)},E=async()=>{U.value&&await U.value.validate(async e=>{if(e){r.value=!0;try{if(!a.isAuthenticated)throw new Error("请先登录");const e={displayName:V.displayName,email:V.email,avatarUrl:V.avatarUrl};await i.A.put("/auth/profile",e);V.newPassword?(await i.A.post("/auth/change-password",{oldPassword:V.currentPassword,newPassword:V.newPassword}),o.nk.success("个人信息和密码更新成功，请重新登录"),a.logout(),window.location.href="/login"):(o.nk.success("个人信息更新成功"),await a.fetchUserInfo()),V.currentPassword="",V.newPassword="",V.confirmPassword=""}catch(l){console.error("保存失败:",l),o.nk.error(l.response?.data?.message||l.message||"保存失败")}finally{r.value=!1}}})};return(0,l.sV)(async()=>{if(!a.user&&a.isAuthenticated)try{await a.fetchUserInfo()}catch(e){return console.error("获取用户信息失败:",e),void o.nk.error("获取用户信息失败，请重新登录")}M(),B()}),(e,a)=>{const o=(0,l.g2)("el-icon"),u=(0,l.g2)("el-avatar"),d=(0,l.g2)("el-divider"),i=(0,l.g2)("el-card"),B=(0,l.g2)("el-col"),M=(0,l.g2)("el-button"),S=(0,l.g2)("el-input"),$=(0,l.g2)("el-form-item"),q=(0,l.g2)("el-form"),x=(0,l.g2)("el-row");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(x,{gutter:20},{default:(0,l.k6)(()=>[(0,l.bF)(B,{span:8},{default:(0,l.k6)(()=>[(0,l.bF)(i,{class:"user-info-card"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",m,[(0,l.bF)(u,{size:100,src:A.value?.avatarUrl},{default:(0,l.k6)(()=>[(0,l.bF)(o,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,s.R1)(n.User))]),_:1})]),_:1},8,["src"]),(0,l.Lk)("div",f,(0,t.v_)(A.value?.displayName||A.value?.username),1),(0,l.Lk)("div",p,(0,t.v_)(A.value?.role||"USER"),1)]),(0,l.bF)(d),(0,l.Lk)("div",v,[(0,l.Lk)("div",w,[a[7]||(a[7]=(0,l.Lk)("div",{class:"stat-label"},"注册时间",-1)),(0,l.Lk)("div",b,(0,t.v_)(K(A.value?.createTime)),1)]),(0,l.Lk)("div",g,[a[8]||(a[8]=(0,l.Lk)("div",{class:"stat-label"},"最后登录",-1)),(0,l.Lk)("div",k,(0,t.v_)(K(A.value?.lastLoginTime)),1)]),(0,l.Lk)("div",h,[a[9]||(a[9]=(0,l.Lk)("div",{class:"stat-label"},"存储配额",-1)),(0,l.Lk)("div",_,(0,t.v_)(R(A.value?.quotaLimit||1073741824)),1)]),(0,l.Lk)("div",y,[a[10]||(a[10]=(0,l.Lk)("div",{class:"stat-label"},"已用存储",-1)),(0,l.Lk)("div",F,(0,t.v_)(R(L.value.usedStorage||0)),1)])])]),_:1})]),_:1}),(0,l.bF)(B,{span:16},{default:(0,l.k6)(()=>[(0,l.bF)(i,{class:"profile-edit-card"},{header:(0,l.k6)(()=>[(0,l.Lk)("div",P,[a[12]||(a[12]=(0,l.Lk)("span",null,"个人信息",-1)),(0,l.bF)(M,{type:"primary",onClick:E,loading:r.value},{default:(0,l.k6)(()=>[...a[11]||(a[11]=[(0,l.eW)(" 保存修改 ",-1)])]),_:1},8,["loading"])])]),default:(0,l.k6)(()=>[(0,l.bF)(q,{ref_key:"profileFormRef",ref:U,model:V,rules:N,"label-width":"100px"},{default:(0,l.k6)(()=>[(0,l.bF)($,{label:"用户名",prop:"username"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.username,"onUpdate:modelValue":a[0]||(a[0]=e=>V.username=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,l.bF)($,{label:"邮箱",prop:"email"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.email,"onUpdate:modelValue":a[1]||(a[1]=e=>V.email=e)},null,8,["modelValue"])]),_:1}),(0,l.bF)($,{label:"显示名称",prop:"displayName"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.displayName,"onUpdate:modelValue":a[2]||(a[2]=e=>V.displayName=e),placeholder:"请输入显示名称"},null,8,["modelValue"])]),_:1}),(0,l.bF)($,{label:"头像URL",prop:"avatarUrl"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.avatarUrl,"onUpdate:modelValue":a[3]||(a[3]=e=>V.avatarUrl=e),placeholder:"请输入头像URL"},null,8,["modelValue"])]),_:1}),(0,l.bF)(d),a[13]||(a[13]=(0,l.Lk)("h3",null,"修改密码",-1)),(0,l.bF)($,{label:"当前密码",prop:"currentPassword"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.currentPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>V.currentPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,l.bF)($,{label:"新密码",prop:"newPassword"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.newPassword,"onUpdate:modelValue":a[5]||(a[5]=e=>V.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,l.bF)($,{label:"确认密码",prop:"confirmPassword"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:V.confirmPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>V.confirmPassword=e),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}},U=r(1241);const V=(0,U.A)(L,[["__scopeId","data-v-40326460"]]);var A=V},7504:function(e,a,r){r.d(a,{H5:function(){return u},Jk:function(){return s},QF:function(){return m},QM:function(){return t},VX:function(){return c},Ww:function(){return n},_K:function(){return d},cH:function(){return f},downloadFile:function(){return o},wb:function(){return i}});var l=r(5720);function s(e){return(0,l.A)({url:"/files/list",method:"get",params:e})}function t(e,a){return(0,l.A)({url:"/files/upload",method:"post",data:e,onUploadProgress:a,timeout:3e5})}function o(e){return(0,l.A)({url:`/files/download/${e}`,method:"get",responseType:"blob"})}function n(e){return(0,l.A)({url:`/files/${e}`,method:"delete"})}function u(e,a){return(0,l.A)({url:`/files/${e}/rename`,method:"put",data:{name:a}})}function d(e){return(0,l.A)({url:"/files/search",method:"get",params:{keyword:e}})}function i(){return(0,l.A)({url:"/files/recycle/bin",method:"get"})}function c(e){return(0,l.A)({url:`/files/${e}/restore`,method:"put"})}function m(e){return(0,l.A)({url:`/files/recycle/bin/${e}`,method:"delete"})}function f(){return(0,l.A)({url:"/files/recycle/bin/empty",method:"delete"})}}}]);
//# sourceMappingURL=693.75b6cd41.js.map