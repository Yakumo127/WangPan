"use strict";(self["webpackChunkenterprise_file_manager_frontend"]=self["webpackChunkenterprise_file_manager_frontend"]||[]).push([[166],{3166:function(e,a,l){l.r(a),l.d(a,{default:function(){return V}});var t=l(6768),r=l(144),o=l(4232),u=l(1219),n=l(2933),s=l(7477),d=l(5720);function i(e){return(0,d.A)({url:"/admin/users",method:"get",params:e})}function p(e){return(0,d.A)({url:"/admin/users",method:"post",data:e})}function c(e,a){return(0,d.A)({url:`/admin/users/${e}`,method:"put",data:a})}function m(e){return(0,d.A)({url:`/admin/users/${e}`,method:"delete"})}function b(e){const a=new FormData;return a.append("file",e),(0,d.A)({url:"/admin/users/import",method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}})}function g(e){return(0,d.A)({url:"/admin/users/export",method:"get",params:e,responseType:"blob"})}const k={class:"users-container"},f={class:"operation-bar"},v={class:"pagination"},w={class:"dialog-footer"},y={class:"dialog-footer"};var _={__name:"Users",setup(e){const a=(0,r.KR)([]),l=(0,r.KR)(!1),d=(0,r.KR)(""),_=(0,r.KR)(1),F=(0,r.KR)(10),h=(0,r.KR)(0),V=(0,r.KR)(!1),R=(0,r.KR)(""),x=(0,r.KR)(!1),U=(0,r.KR)(null),C=(0,r.Kh)({id:null,username:"",email:"",displayName:"",password:"",role:"USER",enabled:!0}),W={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3到20个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],displayName:[{required:!0,message:"请输入显示名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},L=(0,r.KR)(),A=(0,r.KR)(),K=async()=>{l.value=!0;try{const e={page:_.value,size:F.value,keyword:d.value},l=await i(e);console.log("API Response:",l),Array.isArray(l)?(a.value=l,h.value=l.length):l.data?(a.value=l.data,h.value=l.total||l.data.length):(a.value=[],h.value=0)}catch(e){console.error("加载用户列表失败:",e),u.nk.error("加载用户列表失败")}finally{l.value=!1}},N=async()=>{console.log("搜索用户:",d.value),_.value=1,await K()},z=()=>{R.value="添加用户",Object.assign(C,{id:null,username:"",email:"",displayName:"",password:"",role:"USER",enabled:!0}),V.value=!0},S=e=>{R.value="编辑用户",Object.assign(C,e),C.password="",V.value=!0},T=async()=>{L.value&&await L.value.validate(async e=>{if(e)try{C.id?(await c(C.id,C),u.nk.success("用户更新成功")):(await p(C),u.nk.success("用户创建成功")),V.value=!1,await K()}catch(a){u.nk.error("操作失败："+a.message)}})},j=async e=>{try{await n.s.confirm(`确定要删除用户 "${e.username}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m(e.id),u.nk.success("用户删除成功"),await K()}catch(a){"cancel"!==a&&u.nk.error("删除失败："+a.message)}},q=()=>{x.value=!0,U.value=null},E=e=>{U.value=e.raw},I=async()=>{if(U.value)try{await b(U.value),u.nk.success("用户导入成功"),x.value=!1,await K()}catch(e){u.nk.error("导入失败："+e.message)}else u.nk.warning("请选择要导入的文件")},D=async()=>{try{const e=await g(),a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(a),t=document.createElement("a");t.href=l,t.download="用户列表.xlsx",t.click(),window.URL.revokeObjectURL(l),u.nk.success("用户导出成功")}catch(e){u.nk.error("导出失败："+e.message)}},O=e=>{console.log("页面大小改变:",e),F.value=e,_.value=1,K()},B=e=>{console.log("当前页改变:",e),_.value=e,K()};return(0,t.sV)(()=>{console.log("Users.vue 组件挂载，开始加载用户列表"),K()}),(e,u)=>{const n=(0,t.g2)("el-icon"),i=(0,t.g2)("el-input"),p=(0,t.g2)("el-button"),c=(0,t.g2)("el-table-column"),m=(0,t.g2)("el-tag"),b=(0,t.g2)("el-table"),g=(0,t.g2)("el-pagination"),U=(0,t.g2)("el-card"),K=(0,t.g2)("el-form-item"),M=(0,t.g2)("el-option"),X=(0,t.g2)("el-select"),$=(0,t.g2)("el-switch"),P=(0,t.g2)("el-form"),Q=(0,t.g2)("el-dialog"),G=(0,t.g2)("el-upload"),H=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",k,[(0,t.bF)(U,{class:"box-card"},{header:(0,t.k6)(()=>[...u[13]||(u[13]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"用户管理")],-1)])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",f,[(0,t.bF)(i,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=e=>d.value=e),placeholder:"搜索用户名或邮箱",style:{width:"200px"},clearable:""},{prefix:(0,t.k6)(()=>[(0,t.bF)(n,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,r.R1)(s.Search))]),_:1})]),_:1},8,["modelValue"]),(0,t.bF)(p,{type:"primary",onClick:N},{default:(0,t.k6)(()=>[...u[14]||(u[14]=[(0,t.eW)("搜索",-1)])]),_:1}),(0,t.bF)(p,{type:"success",onClick:z},{default:(0,t.k6)(()=>[...u[15]||(u[15]=[(0,t.eW)("添加用户",-1)])]),_:1}),(0,t.bF)(p,{type:"warning",onClick:q},{default:(0,t.k6)(()=>[...u[16]||(u[16]=[(0,t.eW)("导入",-1)])]),_:1}),(0,t.bF)(p,{type:"info",onClick:D},{default:(0,t.k6)(()=>[...u[17]||(u[17]=[(0,t.eW)("导出",-1)])]),_:1})]),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(b,{data:a.value,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(c,{prop:"username",label:"用户名",width:"120"}),(0,t.bF)(c,{prop:"email",label:"邮箱",width:"180"}),(0,t.bF)(c,{prop:"displayName",label:"显示名称",width:"120"}),(0,t.bF)(c,{prop:"role",label:"角色",width:"100"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(m,{type:"ADMIN"===e.role?"danger":"primary"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)("ADMIN"===e.role?"管理员":"用户"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(c,{prop:"enabled",label:"状态",width:"100"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(m,{type:e.enabled?"success":"info"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(e.enabled?"激活":"未激活"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(c,{prop:"createTime",label:"创建时间",width:"180"}),(0,t.bF)(c,{prop:"lastLoginTime",label:"最后登录",width:"180"}),(0,t.bF)(c,{label:"操作",width:"200"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(p,{size:"small",onClick:a=>S(e)},{default:(0,t.k6)(()=>[...u[18]||(u[18]=[(0,t.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,t.bF)(p,{size:"small",type:"danger",onClick:a=>j(e)},{default:(0,t.k6)(()=>[...u[19]||(u[19]=[(0,t.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,l.value]]),(0,t.Lk)("div",v,[(0,t.bF)(g,{"current-page":_.value,"onUpdate:currentPage":u[1]||(u[1]=e=>_.value=e),"page-size":F.value,"onUpdate:pageSize":u[2]||(u[2]=e=>F.value=e),"page-sizes":[10,20,50,100],total:h.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:B},null,8,["current-page","page-size","total"])])]),_:1}),(0,t.bF)(Q,{modelValue:V.value,"onUpdate:modelValue":u[10]||(u[10]=e=>V.value=e),title:R.value,width:"500px"},{footer:(0,t.k6)(()=>[(0,t.Lk)("span",w,[(0,t.bF)(p,{onClick:u[9]||(u[9]=e=>V.value=!1)},{default:(0,t.k6)(()=>[...u[20]||(u[20]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(p,{type:"primary",onClick:T},{default:(0,t.k6)(()=>[...u[21]||(u[21]=[(0,t.eW)("确定",-1)])]),_:1})])]),default:(0,t.k6)(()=>[(0,t.bF)(P,{ref_key:"userFormRef",ref:L,model:C,rules:W,"label-width":"100px"},{default:(0,t.k6)(()=>[(0,t.bF)(K,{label:"用户名",prop:"username"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:C.username,"onUpdate:modelValue":u[3]||(u[3]=e=>C.username=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(K,{label:"邮箱",prop:"email"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:C.email,"onUpdate:modelValue":u[4]||(u[4]=e=>C.email=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(K,{label:"显示名称",prop:"displayName"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:C.displayName,"onUpdate:modelValue":u[5]||(u[5]=e=>C.displayName=e)},null,8,["modelValue"])]),_:1}),C.id?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(K,{key:0,label:"密码",prop:"password"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:C.password,"onUpdate:modelValue":u[6]||(u[6]=e=>C.password=e),type:"password"},null,8,["modelValue"])]),_:1})),(0,t.bF)(K,{label:"角色",prop:"role"},{default:(0,t.k6)(()=>[(0,t.bF)(X,{modelValue:C.role,"onUpdate:modelValue":u[7]||(u[7]=e=>C.role=e),style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(M,{label:"用户",value:"USER"}),(0,t.bF)(M,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(K,{label:"状态",prop:"enabled"},{default:(0,t.k6)(()=>[(0,t.bF)($,{modelValue:C.enabled,"onUpdate:modelValue":u[8]||(u[8]=e=>C.enabled=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,t.bF)(Q,{modelValue:x.value,"onUpdate:modelValue":u[12]||(u[12]=e=>x.value=e),title:"导入用户",width:"400px"},{footer:(0,t.k6)(()=>[(0,t.Lk)("span",y,[(0,t.bF)(p,{onClick:u[11]||(u[11]=e=>x.value=!1)},{default:(0,t.k6)(()=>[...u[24]||(u[24]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(p,{type:"primary",onClick:I},{default:(0,t.k6)(()=>[...u[25]||(u[25]=[(0,t.eW)("确定",-1)])]),_:1})])]),default:(0,t.k6)(()=>[(0,t.bF)(G,{ref_key:"uploadRef",ref:A,class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:".xlsx,.xls",onChange:E},{tip:(0,t.k6)(()=>[...u[22]||(u[22]=[(0,t.Lk)("div",{class:"el-upload__tip"}," 只能上传xlsx/xls文件 ",-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(n,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)((0,r.R1)(s.UploadFilled))]),_:1}),u[23]||(u[23]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" 拖拽文件到此处或 "),(0,t.Lk)("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"])])}}},F=l(1241);const h=(0,F.A)(_,[["__scopeId","data-v-0b8884b9"]]);var V=h}}]);
//# sourceMappingURL=166.22ca94c0.js.map