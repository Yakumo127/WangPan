{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"files-container\"\n};\nconst _hoisted_2 = {\n  class: \"card-header\"\n};\nconst _hoisted_3 = {\n  class: \"pagination\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_upload_filled = _resolveComponent(\"upload-filled\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, {\n    class: \"box-card\"\n  }, {\n    header: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_cache[5] || (_cache[5] = _createElementVNode(\"span\", null, \"文件管理\", -1)), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: _cache[0] || (_cache[0] = $event => $setup.showUploadDialog = true)\n    }, {\n      default: _withCtx(() => [...(_cache[4] || (_cache[4] = [_createTextVNode(\" 上传文件 \", -1)]))]),\n      _: 1\n    })])]),\n    default: _withCtx(() => [_createVNode(_component_el_table, {\n      data: $setup.files,\n      style: {\n        \"width\": \"100%\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        prop: \"fileName\",\n        label: \"文件名\",\n        width: \"200\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"fileSize\",\n        label: \"文件大小\",\n        width: \"120\"\n      }, {\n        default: _withCtx(scope => [_createTextVNode(_toDisplayString($setup.formatFileSize(scope.row.fileSize)), 1)]),\n        _: 1\n      }), _createVNode(_component_el_table_column, {\n        prop: \"contentType\",\n        label: \"文件类型\",\n        width: \"120\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"downloadCount\",\n        label: \"下载次数\",\n        width: \"100\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"createTime\",\n        label: \"创建时间\",\n        width: \"180\"\n      }, {\n        default: _withCtx(scope => [_createTextVNode(_toDisplayString($setup.formatDate(scope.row.createTime)), 1)]),\n        _: 1\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\",\n        width: \"200\"\n      }, {\n        default: _withCtx(scope => [_createVNode(_component_el_button, {\n          size: \"small\",\n          onClick: $event => $setup.downloadFile(scope.row)\n        }, {\n          default: _withCtx(() => [...(_cache[6] || (_cache[6] = [_createTextVNode(\" 下载 \", -1)]))]),\n          _: 1\n        }, 8, [\"onClick\"]), _createVNode(_component_el_button, {\n          size: \"small\",\n          type: \"danger\",\n          onClick: $event => $setup.deleteFile(scope.row)\n        }, {\n          default: _withCtx(() => [...(_cache[7] || (_cache[7] = [_createTextVNode(\" 删除 \", -1)]))]),\n          _: 1\n        }, 8, [\"onClick\"])]),\n        _: 1\n      })]),\n      _: 1\n    }, 8, [\"data\"]), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_pagination, {\n      \"current-page\": $setup.currentPage,\n      \"onUpdate:currentPage\": _cache[1] || (_cache[1] = $event => $setup.currentPage = $event),\n      \"page-size\": $setup.pageSize,\n      \"onUpdate:pageSize\": _cache[2] || (_cache[2] = $event => $setup.pageSize = $event),\n      total: $setup.total,\n      \"page-sizes\": [10, 20, 50, 100],\n      layout: \"total, sizes, prev, pager, next, jumper\",\n      onSizeChange: $setup.handleSizeChange,\n      onCurrentChange: $setup.handleCurrentChange\n    }, null, 8, [\"current-page\", \"page-size\", \"total\", \"onSizeChange\", \"onCurrentChange\"])])]),\n    _: 1\n  }), _createVNode(_component_el_dialog, {\n    modelValue: $setup.showUploadDialog,\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.showUploadDialog = $event),\n    title: \"上传文件\",\n    width: \"500px\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_upload, {\n      class: \"upload-demo\",\n      drag: \"\",\n      action: \"/api/files/upload\",\n      headers: $setup.uploadHeaders,\n      \"on-success\": $setup.handleUploadSuccess,\n      \"on-error\": $setup.handleUploadError,\n      \"before-upload\": $setup.beforeUpload\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_icon, {\n        class: \"el-icon--upload\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_upload_filled)]),\n        _: 1\n      }), _cache[8] || (_cache[8] = _createElementVNode(\"div\", {\n        class: \"el-upload__text\"\n      }, [_createTextVNode(\" 拖拽文件到此处或 \"), _createElementVNode(\"em\", null, \"点击上传\")], -1))]),\n      _: 1\n    }, 8, [\"headers\", \"on-success\", \"on-error\", \"before-upload\"])]),\n    _: 1\n  }, 8, [\"modelValue\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_createElementVNode","_hoisted_2","_component_el_button","type","onClick","_cache","$event","$setup","showUploadDialog","_component_el_table","data","files","style","_component_el_table_column","prop","label","width","default","scope","formatFileSize","row","fileSize","formatDate","createTime","size","downloadFile","deleteFile","_hoisted_3","_component_el_pagination","currentPage","pageSize","total","layout","onSizeChange","handleSizeChange","onCurrentChange","handleCurrentChange","_component_el_dialog","title","_component_el_upload","drag","action","headers","uploadHeaders","handleUploadSuccess","handleUploadError","beforeUpload","_component_el_icon","_component_upload_filled"],"sources":["/workspace/frontend/src/views/admin/Files.vue"],"sourcesContent":["<template>\n  <div class=\"files-container\">\n    <el-card class=\"box-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <span>文件管理</span>\n          <el-button type=\"primary\" @click=\"showUploadDialog = true\">\n            上传文件\n          </el-button>\n        </div>\n      </template>\n      \n      <el-table :data=\"files\" style=\"width: 100%\">\n        <el-table-column prop=\"fileName\" label=\"文件名\" width=\"200\" />\n        <el-table-column prop=\"fileSize\" label=\"文件大小\" width=\"120\">\n          <template #default=\"scope\">\n            {{ formatFileSize(scope.row.fileSize) }}\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"contentType\" label=\"文件类型\" width=\"120\" />\n        <el-table-column prop=\"downloadCount\" label=\"下载次数\" width=\"100\" />\n        <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"180\">\n          <template #default=\"scope\">\n            {{ formatDate(scope.row.createTime) }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"200\">\n          <template #default=\"scope\">\n            <el-button size=\"small\" @click=\"downloadFile(scope.row)\">\n              下载\n            </el-button>\n            <el-button size=\"small\" type=\"danger\" @click=\"deleteFile(scope.row)\">\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      \n      <div class=\"pagination\">\n        <el-pagination\n          v-model:current-page=\"currentPage\"\n          v-model:page-size=\"pageSize\"\n          :total=\"total\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n    </el-card>\n    \n    <!-- 上传对话框 -->\n    <el-dialog v-model=\"showUploadDialog\" title=\"上传文件\" width=\"500px\">\n      <el-upload\n        class=\"upload-demo\"\n        drag\n        action=\"/api/files/upload\"\n        :headers=\"uploadHeaders\"\n        :on-success=\"handleUploadSuccess\"\n        :on-error=\"handleUploadError\"\n        :before-upload=\"beforeUpload\"\n      >\n        <el-icon class=\"el-icon--upload\"><upload-filled /></el-icon>\n        <div class=\"el-upload__text\">\n          拖拽文件到此处或 <em>点击上传</em>\n        </div>\n      </el-upload>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from 'vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { UploadFilled } from '@element-plus/icons-vue'\nimport { getFiles, deleteFile as deleteFileApi } from '@/api/file'\nimport { getToken } from '@/utils/auth'\n\nexport default {\n  name: 'Files',\n  components: {\n    UploadFilled\n  },\n  setup() {\n    const files = ref([])\n    const currentPage = ref(1)\n    const pageSize = ref(20)\n    const total = ref(0)\n    const showUploadDialog = ref(false)\n    \n    const uploadHeaders = {\n      'Authorization': `Bearer ${getToken()}`\n    }\n    \n    const loadFiles = async () => {\n      try {\n        const response = await getFiles({\n          page: currentPage.value - 1,\n          size: pageSize.value\n        })\n        files.value = response.data.content\n        total.value = response.data.totalElements\n      } catch (error) {\n        ElMessage.error('加载文件列表失败')\n      }\n    }\n    \n    const handleSizeChange = (val) => {\n      pageSize.value = val\n      loadFiles()\n    }\n    \n    const handleCurrentChange = (val) => {\n      currentPage.value = val\n      loadFiles()\n    }\n    \n    const downloadFile = (file) => {\n      window.open(`/api/files/download/${file.id}`, '_blank')\n    }\n    \n    const deleteFile = async (file) => {\n      try {\n        await ElMessageBox.confirm('确定要删除这个文件吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        })\n        \n        await deleteFileApi(file.id)\n        ElMessage.success('删除成功')\n        loadFiles()\n      } catch (error) {\n        if (error !== 'cancel') {\n          ElMessage.error('删除失败')\n        }\n      }\n    }\n    \n    const beforeUpload = (file) => {\n      const isLt100M = file.size / 1024 / 1024 < 100\n      if (!isLt100M) {\n        ElMessage.error('文件大小不能超过 100MB!')\n      }\n      return isLt100M\n    }\n    \n    const handleUploadSuccess = () => {\n      ElMessage.success('上传成功')\n      showUploadDialog.value = false\n      loadFiles()\n    }\n    \n    const handleUploadError = () => {\n      ElMessage.error('上传失败')\n    }\n    \n    const formatFileSize = (bytes) => {\n      if (bytes === 0) return '0 B'\n      const k = 1024\n      const sizes = ['B', 'KB', 'MB', 'GB']\n      const i = Math.floor(Math.log(bytes) / Math.log(k))\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n    }\n    \n    const formatDate = (dateString) => {\n      return new Date(dateString).toLocaleString()\n    }\n    \n    onMounted(() => {\n      loadFiles()\n    })\n    \n    return {\n      files,\n      currentPage,\n      pageSize,\n      total,\n      showUploadDialog,\n      uploadHeaders,\n      handleSizeChange,\n      handleCurrentChange,\n      downloadFile,\n      deleteFile,\n      beforeUpload,\n      handleUploadSuccess,\n      handleUploadError,\n      formatFileSize,\n      formatDate\n    }\n  }\n}\n</script>\n\n<style scoped>\n.files-container {\n  padding: 20px;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.pagination {\n  margin-top: 20px;\n  text-align: right;\n}\n\n.upload-demo {\n  text-align: center;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}